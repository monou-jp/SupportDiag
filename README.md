# SupportDiag

## 概要

CGI設置時のサポート情報出力スクリプトです。サーバー環境の診断情報を収集し、技術サポートに必要な情報を効率的に提供するためのツールです。

## 主な機能

- **基本情報の収集**: 掲示板にコピペしやすいテキスト形式で環境情報を表示
- **詳細情報の生成**: JSON形式で詳細なシステム情報を出力
- **暗号化機能**: OpenSSLがある場合、ハイブリッド暗号化（AES-256-CBC + RSA-OAEP）で情報を保護
- **CLI/CGI両対応**: コマンドラインでもWebサーバー経由でも実行可能
- **依存関係なし**: Python標準ライブラリのみを使用
- **幅広いPython対応**: Python 2.7から3.x系まで対応

## 使用方法

### コマンドライン実行

```bash
python sds.py
```

基本情報がテキスト形式で表示されます。詳細情報のJSONファイルとして出力される場合は、公開鍵が設定されていればdata.encとkey.encファイルが生成されます。

### Webサーバー経由（CGI）

1. WebサーバーのCGI対応ディレクトリにスクリプトを設置
2. ブラウザからアクセス
3. Web画面上で診断情報の確認と暗号化ファイルのダウンロードが可能

### 内蔵HTTPサーバーの使用

```bash
python sds.py --server
```

デフォルトで http://127.0.0.1:8000 でWebサーバーが起動します。

## 公開鍵の設定

暗号化機能を使用する場合、以下のいずれかの方法で公開鍵を設定してください：

1. **環境変数**: `SUPPORT_PUBKEY_PEM` に PEM文字列を設定
2. **ファイル**: スクリプトと同じディレクトリに `support_pubkey.pem` を配置
3. **直接埋め込み**: スクリプト内の `PLACEHOLDER_PUBLIC_KEY` 部分に公開鍵を貼り付け（推奨）

## 収集される情報

### 基本情報
- Python バージョンと実装
- プラットフォーム情報
- 実行パス情報

### 詳細情報
- システム環境変数
- インストール済みモジュール一覧
- ファイル書き込み権限テスト結果
- パッケージ情報（可能な場合）

## 暗号化について

- OpenSSLが利用可能な場合、自動でハイブリッド暗号化を実行
- AES-256-CBCで実際のデータを暗号化
- RSA-OAEPでAESキーを暗号化
- 結果として `data.enc`（暗号化データ）と `key.enc`（暗号化キー）を生成

## 技術仕様

- **言語**: Python（2.7/3.5+対応）
- **依存関係**: 標準ライブラリのみ
- **暗号化**: AES-256-CBC + RSA-OAEP（OpenSSL使用）
- **出力形式**: テキスト、JSON、暗号化バイナリ

## ライセンス

このプロジェクトのライセンスについては、LICENSEファイルを参照してください。
